\documentclass{article}
\usepackage[most]{tcolorbox}
\usepackage[a4paper,top=1in, bottom=1.25in, left=1.25in, right=1.25in]{geometry}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{capt-of}
\usepackage{graphicx}
\usepackage{caption,subcaption}
\usepackage{url}
\usepackage{multirow}
\usepackage{enumerate}
%\usepackage{tikz}
\usepackage{epstopdf}% To incorporate .eps illustrations using PDFLaTeX, etc.
%\usepackage{subfigure}% Support for small, `sub' figures and tables
\usepackage{nameref}
\usepackage{zref-xr,zref-user}
\usepackage{natbib}
\zxrsetup{toltxlabel=true, tozreflabel=false}
%\zexternaldocument*[original:]{TSC}
\usepackage{xcite}
\usepackage{hyperref}
\usepackage{ulem}
\usepackage{bm}
\usepackage{optidef}
%\externalcitedocument[org:]{TSC}

%\usepackage[table]{xcolor}
%\usepackage{color}
%\usepackage{colortbl}

\definecolor{Gray}{gray}{0.9}
\newcommand{\coldscr}{\cellcolor{Gray}}

\newcommand{\initresponses}{\newcounter{pointcounter}}

\newenvironment{reviewer}{\setcounter{pointcounter}{1}}{}

\newenvironment{mybiblio}{\small}{}


%\newcommand{\point}{{\textsl{\thepointcounter}. \stepcounter{pointcounter} #1}}

%\newcommand{\point}[1]{\medskip \noindent \text{{\selectfont \thepointcounter} \stepcounter{pointcounter} #1}}

\newcommand{\point}{\text{{\selectfont \thepointcounter} \stepcounter{pointcounter}}}


\newcommand{\mynum}[1]{^{(#1)}}
\newcommand{\myi}{\mynum{i}}
\newcommand{\mym}{\mynum{m}}
\newcommand{\mymi}{\mynum{m,i}}
\newcommand{\myMi}{\mynum{M,i}}
\newcommand{\myq}{\mynum{q,i}}
\newcommand{\myzeroi}{\mynum{0,i}}
\newcommand{\myduei}{^{(i)\;2}}
\newcommand{\JP}[1]{{\color{black}#1}}
\newcommand{\LA}[1]{{\color{red}#1}}
\newcommand{\TP}[1]{{\color{orange}#1}}
\begin{comment}
	\usetikzlibrary{shapes.geometric,backgrounds,
		positioning-plus,node-families,calc}
	\tikzset{
		basic box/.style = {
			shape = rectangle,
			align = center,
			draw  = #1,
			fill  = #1!25,
			rounded corners},
		header node/.style = {
			Minimum Width = 0.4cm,
			font          = \strut\scriptsize\ttfamily,
			text depth    = +0pt,
			fill          = white,
			draw},
		header/.style = {%
			inner ysep = +1.5em,
			append after command = {
				\pgfextra{\let\TikZlastnode\tikzlastnode}
				node [header node] (header-\TikZlastnode) at (\TikZlastnode.north) {#1}
				node [span = (\TikZlastnode)(header-\TikZlastnode)]
				at (fit bounding box) (h-\TikZlastnode) {}
			}
		},
		hv/.style = {to path = {-|(\tikztotarget)\tikztonodes}},
		vh/.style = {to path = {|-(\tikztotarget)\tikztonodes}},
		fat blue line/.style = {ultra thick, blue}
	}
	
	\tikzstyle{dummy} = [rectangle, text width=0.1em, draw=white, white,
	minimum width=0.1em, minimum height=3em, opacity=0.0]
	
	\tikzstyle{mycircle} = [circle, draw=black, black, text width=1em, minimum height=1em]
	
	\tikzstyle{mydiamond} = [diamond, aspect=2, draw=gray, fill=gray!25, text width=6em, minimum height=1em]
	
	\tikzstyle{startend} =  [rectangle, font=\strut\scriptsize\ttfamily, text depth=+0pt, fill=white, draw=black]
\end{comment}

\hyphenation{dif-fe-rent}

\title{CAOR-D-22-01397R1
	\\
	"The Hampered K-Median Problem with Neighbourhoods"}
\author{Answer to Reviewers' Comments}
\begin{document}
	\maketitle
	%\begin{abstract}
	%\todo[inline,color=green!50]
	%{Abstract changed to adapt to format indicated in
		%guidelines to authors. Text has beeen changed to
		%reflect the update of Section 2 and Discussion.}
	%\lipsum[1]
	%\end{abstract}
	%\section{Introduction}
	%Really et al. (2010)
	%\todo[color=blue!40]{Added citation}
	%said some important suff.\lipsum[2]
	%\lipsum[3]
	
	We wish to thank the editors and reviewers for their valuable comments and advice which allowed us to further improve the quality and presentation of our article through this revision.
	
	We revised the manuscript taking into account all the suggestions of Reviewers 1 and 3. We highlight all the changes in the revised manuscript in blue. In the following, we report our changes inside the coloured textboxes.
	%{\bf We outlined in bold each change made in this new version of the paper}.
	\initresponses
	
	\begin{reviewer}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=red!75!black,colframe=red!75!black,borderline={1pt}{0pt}{black},boxrule=0pt]
			\textbf{Reviewer 1}
		\end{tcolorbox}
		
		\begin{itshape}
			I very much appreciate the effort that the authors have made to clarify the application potential of this paper.

			I would like the case study to include more explanation of the implications of the results to both the delivery company as well as to the population receiving the service.

			As the number of vans is increased, clearly the results get better and there is a concave effect in the objective function value (decreasing marginal return). However, the relationship to the number of drones needed to achieve the delivery is not explored. If there is only one van it may need seven drones to achieve the delivery volume for that day. If there are three vans, between them maybe they can use just five drones to achieve the same service level.

			I don't want the authors to do any complicated modeling or change what they have in other sections, but would like them to expand the case study to include the implications of number of vans and number of drones for various situations. The situations of course relate to the volume of delivery (which is not captured in the median context but these numbers can be developed for illustrative purposes).

			Ideally, the analysis would spell out implications for the delivery company (which aims to minimize van/drone cost while achieving a desired service level) and for the population (which wants to see a desired service level as a whole and more specifically for customers that live in the defined neighborhoods).

			Please note that the above comments are aimed at improving the linkage of the model to a real delivery application, which I think is significant and needs further exploration.

		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=red!5!white,colframe=red!75!black,title=\textbf{Answer R1.\point},borderline={1pt}{0pt}{black},boxrule=0pt]

		\end{tcolorbox}
		
	\end{reviewer}
	
	\newpage
	\begin{reviewer}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!75!black,colframe=green!75!black,borderline={1pt}{0pt}{black},boxrule=0pt]
			\textbf{Reviewer 3}
		\end{tcolorbox}
		
		\begin{itshape}
			The authors have significanty improved their manuscript, and they have properly addresssed all my comments.
			I therefore recommend acceptance, after correcting some minor issues mentioned below.

		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
		We thank the referee for his/her detailed evaluation which we appreciate very much.
			
		\end{tcolorbox}
		
		\subsection*{Minor issues}
				
		\begin{itshape}
			In the single commodity flow formulation, the authors omit superscript $S$ in the definition of flow variables.
I believe that this can be done in networks only if the set of sources and targets are disjoint (is this condition guaranteed in the given setting)?
- Table 1: I would change the description of f_PP' variables into "number of commodities routed through edge PP'..." (the same holds for the text on page 9 just above the formulas for SCF)
- page 9: In the formula (single-flow-C) "if P in V_S" should be changed into "if P=S \in \mathcal{S}" and in the third line "if P in V_T" should be changed into "if P \in \mathcal{T}"
- page 9: in the (multi-flow-C) please replace S and T with their caligraphic versions in the "if" conditions
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			In \textit{Section 2.1. Parameters and Assumptions of the Problem}, we have included the following paragraph: 

			\medskip
			
			In this work, the set of neighbourhoods $\mathcal N=\mathcal S\cup\mathcal T$ are assumed to be compact, closed, and convex sets. These sets can be represented by second-order cone constraints, as explained in Section 3.3. 
		\end{tcolorbox}
		
		\begin{itshape}
			Moreover, condition $A_4$ is not clear to me - it is not clear to me why it is important for the input of the H-KMPN that there is no straight-line connecting a client-facility pair without crossing any barrier? And why introducing such a possibility causes later non-convexities in the linearized MISOCP formulation. These points have to be better explained on page 10 (where the authors just state that product of continuous variables in alpha-constraints introduces non-convexities).		
		\end{itshape}
	
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			In the part of the manuscript in which $\alpha$ constraints are introduced, we have introduced the following paragraph:
			\medskip
			
			The fact of considering the possibility of going directly from one neighbourhood  to another leads to include product of continuous variables, presented in the determinants of the $\alpha$ constraints of the model. Specifically, for the tuples $(P, Q, Q')\in V_\mathcal B\times E_{\mathcal S\mathcal T}$, the determinant $\det(P|QQ')$ produces bilinear terms. These products cause the general H-KMPN to become non-convex. However, for the hidden version, since two of the three arguments of the determinant are fixed because $E_{\mathcal S\mathcal T}$ is not considered, the constraints $\alpha$ become linear. This difference justifies the comparison between the two formulations in terms of the computational cost studied in Section 5.
		\end{tcolorbox}
	
		\begin{itshape}
			In Section 2.2. in the definition of the objective function, it should be mentioned that one minimizes the two sums, one of the weighted lengths and one of weigthed link distances. Moreover, more motivation for a choice of such objective function is needed.
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			We have described with more precision the objective function represented in our problem after the description of the first formulation. We have also inserted a reference that motivates the use of the link distance in this kind of problem:\medskip
			
			The objective function takes into account both the Euclidean and link weighted distances to join the selected sources with their assigned targets. The term related to the Euclidean distance is divided into two parts. The first accounts for the variable distances, while the distances in the second are known beforehand. Inspired by a drone routing application, the link distance refers to the vehicle's rotation cost (see \cite{maheshwari2000} for more details).
			
		\end{tcolorbox}
	
		\begin{itshape}
			When introducing the graph $G_X$, it is not clear whether points $P_S$, $P_T$ are given in advance, or whether we are searching for their coordinates (the latter is the case, but this becomes clear much later in the paper after introducing the full MINLP model). 
		\end{itshape}
	
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			We have given details in the description of the problem by including the notation for the points selected in $\mathcal S$ and $\mathcal T$. Additionally, we have better explained how the visibility graph is built by arguing that it is a ``variable'' graph that depends on the location of its vertices to determine which are its edges. \textbf{Section 2. Description of the problem. Paragraph prior to Proposition 1.}
		\end{tcolorbox}
		
		\begin{itshape}
			For the set $E_{\mathcal S \mathcal T}$, shouldn't we also add in the definition that these line segments should not cross any other barrier from $B$?
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			Yes. We have inserted the correct description of the set of edges $E_{\mathcal S\mathcal T}$.
		\end{tcolorbox}
		
		\begin{itshape}
			When introducing constraints ($\mathcal N$-C), please mention that $P_N$ are variables.
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			Thank you. We have explained that $P_N$ represents the coordinates of the variable point selected in $N$.
		\end{tcolorbox}
		
		\subsection*{MINLP formulation}
		\begin{itshape}
			When introducing model variables, what is the domain of variables - for example, for $\alpha(P|QQ')$, where does $P$, $Q$, and $Q'$ come from? The same has to be clarified for all variables used in the model. I recommend to use notation $f^{ST}_{PQ}$ instead of $f(PQ|ST)$, first, because it is a common way to state flow along a segment $PQ$ for the commodity $ST$ in that way, and second, to avoid confusion with the determinants notation (see minor remarks below). For all introduced constraints, please introduce quantifiers and variable domains for which these constraints are imposed.
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			In Section 3, we have performed a deep revision to unify the notation to be more similar to the common way of representing the variables. These changes are described in the following:
			\begin{itemize}
				\item $y(S)\rightarrow y^S$.
				\item $x(ST)\rightarrow x^{ST}$.
				\item $f(PP')\rightarrow f_{PP'}$.
				\item $f(PP'|ST)\rightarrow f_{PP'}^{ST}$.
				\item $\alpha(P|QR)\rightarrow \alpha_{PQR}$.
				\item $\beta(PP'|QQ')\rightarrow \delta_{PP'QQ'}$.
				\item $\gamma(PP'|QQ')\rightarrow \varepsilon_{PP'QQ'}$.
				\item $\delta(PP'|QQ')\rightarrow \zeta_{PP'QQ'}$.
				\item $\varepsilon(PP')\rightarrow \eta_{PP'}$.
				\item $d(PP')\rightarrow d_{PP'}$.
			\end{itemize}
			
			In addition, we have modified the table that describes the variables by including the domains and ranges of these variables. These domains are used to simplify the description of the constraints $\alpha$, $\delta$, $\varepsilon$, $\zeta$ and $\eta$. Furthermore, we have inserted the ranges of all of these variables in each formulation.
			
			
		\end{tcolorbox}
			
		\begin{itshape}
			 The authors state that they use single-commodity flow formulation to model client-facility allocation paths, however, their model is a mix between single- and multi-commodity formulation (SCF and MCF, respectively). This has to be corrected, and, in addition, there are indeed two ways to model it, as described below.
			
			\begin{itemize}
				\item In the MCF approach, we need binary variables $f^{ST}_{PQ}$ to be set to one for each ST pair, if line segment connecting $P$ and $Q$ is used. For constraints (f-C), what is the definition of $f(PQ)$ and what is the link between $f^{ST}_{PQ}$ and $f(PQ)$? I believe constraints (f-C) should be replaced by stronger ones: $f^{ST}_{PQ}\leq \varepsilon(PQ)$ for all $P$, $Q$ (please add the variable domain) and for all $S$, $T$ (please add variable domain). Finally, there is a quantifier missing in the flow-preservation constraints (flow-in equals flow-out): for all $P$ is missing.
				\item In the SCF approach, we would need flow variable indexed by source nodes $S$, modeling a tree routed at $S$ and connecting all targets $T$ such that $x(ST)=1$. These variables can then be denoted as $f^S_{PQ}$ and their value is integer, counting the number of targets $T$ allocated to $S$, that use segment $PQ$. In that case, the constraints (f-C) would read $f^S_{PQ} <= |T| \varepsilon(PQ)$, for all $P$,$Q$,$S$ and in the flow preservation constraints, we will have that the RHS for the flow-preservation constraints for $P=S$ is equal to $\sum_{T \in \mathcal T} x(ST)$.
			\end{itemize}
		
		\end{itshape}


		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			Thanks for your contribution. We have taken into account your comments to differentiate between two formulations that can model the problem we study. In addition, we have structured Section 3 by splitting the formulation in different blocks of constraints that appear in the problem:
			\begin{itemize}
				\item Section 3.1 describes the classical $k$-median constraints.
				\item Section 3.2 represents the path source-target by means of single- and multi-commodity approaches as suggested by the referee.
				\item Section 3.3 states the second-order cone constraints defining neighbourhoods and Euclidean distances.
				\item Section 3.4 makes use of the results of the computational geometry to model the visibility graph.
				\item Section 3.5 presents the single- and multi-commodity formulations for the problem and discusses the linearisation of the objective function using McCormick's envelopes.
			\end{itemize}
		\end{tcolorbox}
		
		\begin{itshape}
			The authors state on page 9 ``The fourth ones are the flow conservation constraints, where the units of commodity launched from the source must be the number of targets that are assigned to that source. The fifth group of inequalities ensures that the trip can reach, in endurance terms, the target T when it starts from the source S.'' From the first sentence, it seems to me the authors had in mind a SCF formulation, but this is not what the current model is providing. The second sentence mentions the fifth group of constraints which is actually missing in the model. Besides, what is meant with ``endurance terms"? In the next MINLP model on page 10, there is a constraint that uses ``endurance" but I do not think the endurance is defined earlier in the paper.
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			We agree with the referee. In a previous version of the paper, we had considered an endurance term that bounds the total distance between each pair of source-targets. However, although it is possible to model this restriction, we have decided to remove it to simplify the problem.
		\end{tcolorbox}
		
		\begin{itshape}
			Proposition 1 should be mentioned right after the problem definition at the end of Section 2. Besides, please give a formal definition of the $k$-median with geodesic distances and and a reference where it is shown that the latter problem is NP-hard.
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			We agree with the referee. We have stated this result right after the problem definition. We have also included this paragraph that argues for this result:
			
			\medskip
			
			Note that once a point is fixed in each neighbourhood, the problem that results in the induced graph $G_X$ is the $k$-median with geodesic distances. This problem is a version of the discrete $k$-median in which the distances are computed beforehand by solving a shortest-path problem for each pair source-target in $G_X$. Hence, it is NP-complete \citep{kariv1979}.
		\end{tcolorbox}
		

		
		\subsection*{Computational results}
		
		\begin{itshape}
			It is important to make publicly available instances used in this paper.
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			All instances used in this work can be downloaded from \cite{valverde2023}.
		\end{tcolorbox}
		
		\begin{itshape}
			Are the authors using some kind of warm-start (sometimes called MIP-start) procedure to provide the solution found by the matheuristic to Gurobi? This should be better clarified.
		\end{itshape}
		
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			In the second paragraph of page 18, we have better clarified that the two formulations of the problem are tested, without and with the initial solution provided by the matheuristic (MIP-start) described in Section 4.
 		\end{tcolorbox}
		
		\begin{itshape}
			What is the major idea behind reporting $Gap_{build}$ - why is it important to look at this metric? Is this a solution found by Gurobi without using matheuristic? Please clarify.
		\end{itshape}

		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			\JP{This metric shows the improvement found by the solver over the initial solution computed by our own matheutistic. This is important to assess the quality of the matheuristic and how it may help to close the gap in difficult instances of the problem.}
		\end{tcolorbox}

		\begin{itshape}
			On page 13 the authors state ``Note that the maximum gap between the best incumbent solution obtained by the matheuristic in a time limit of 100 seconds and the best by the exact formulation after an hour is 5.96\%.'' However, this gap is much larger in the tables provided, so this should be clarified.
		\end{itshape}
  
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
            Reorganisation of Section 5 has changed the results obtained.
		\end{tcolorbox}
  
		\begin{itshape}
			Finally, given that the problem is new and there are no "competitors", it would be interesting to see the difference in the performance between the SCF and MCF model mentioned above.
		\end{itshape}
	
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			\JP{
				Following the referee's advice we have  restructured our computational results section including a full comparison between SCF and MCF models. In addition, we have included the analysis of the influence of the link distance in the difficulty of problem solving. Due to the large number of tables to compare all the factors in the problem, namely different formulations, weight $\omega_L$ for the link distance, number of neighbours and barriers, use of initial solution ..., we have organised the results in tables comparing statistical significance ($p$-values). We believe that this presentation is much more informative and compact.}
		\end{tcolorbox}
	
		\subsection*{Minor concerns}
		
		\begin{itshape}
			\begin{itemize}
				\item Change on-the-self by off-the-shelf.
				\item Section 3.2., line 2: replace $\in E_X$ with ``belongs to $E_X$''.
				\item Please explain what in your notation $det(P_1|PQ)$ means.
				\item When introducing gamma variables, mention that they are also obtained as McCormick linearization.
				\item Please simplify the notation and improve the formatting of the MINLP model on page 9 (there is no need to call the set of vertices $V_{KMPHN}$, you can use much shorter names for a better readability).
				\item Please use wlog or w.l.o.g. consistently.
				\item Please use dots instead of comma for showing decimal numbers.
			\end{itemize}
		\end{itshape}
	
		\begin{tcolorbox}[breakable,enhanced,coltitle=black,colback=green!5!white,colframe=green!75!black,title=\textbf{Answer R2.\point},borderline={1pt}{0pt}{black},boxrule=0pt]
			Thanks for carefully reading the manuscript. The changes that we have made are:
			\begin{itemize}
				\item We have changed \textit{on-the-shelf} by \textit{off-the-shelf}.
				\item We have replaced $\in E_X$ by \textit{ that belongs to $E_X$}.
				\item We have introduced a separated subsection in the \textbf{Section 2} that summarises the notation used along the manuscript.
				\item We have introduced a sentence for the $\varepsilon$ variables that are obtained as a standard McCormick linearisation.
				\item We have made our efforts to improve the notation to make it more clear to the reader.
				\item We have changed \textit{w.l.o.g.} by \textit{wlog}.
				\item We have adopted the decimal point to show the decimal numbers.
			\end{itemize}
		\end{tcolorbox}
	\end{reviewer}
	
	\bibliographystyle{apalike}
	\bibliography{location_barrier_bibliography}
	
	
\end{document}
