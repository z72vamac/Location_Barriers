Reviewer #2: The authors propose a new variant of the k-median problem in which potential facility and client locations are given as neighborhoods (compact regions that can be described using second order cone constraints). In addition, there are line segments representing barriers, and allocations between clients and open facilities should not cross a barrier - instead, they can "touch" the end-points of these line segments, forming barrier-free paths between each allocated client-facility pair. The authors consider two versions of the problem - with and without "hidden neighborhoods".

The authors propose a MINLP problem formulation with bilinear constraints using binary variables. Then, they use standard linearization techniques, to obtain a mixed integer SOCP (for one problem variant). They use the concept of single-commodity flows to model the client-facility paths. They propose a simple initialization heuristic as well and then they evaluate the new model with and without this initialization heuristic on a set of instances with up to 80 nodes.

The content is interesting and relevant for the readership of COR, however, there are several major points that need to be improved before the article can be considered for publication. These points are listed below.

Major concerns:

- Clarity of problem definition: On page 3, Section 3.1: please provide major assumptions regarding the neighborhoods. Are they supposed to be compact, closed, convex sets? Maybe already here you should emphasize that these sets should be such that one can describe them using SOCP constraints? Moreover, condition A4 is not clear to me - it is not clear to me why it is important for the input of the H-KMPN that there is no straight-line connecting a client-facility pair without crossing any barrier? And why introducing such a possibility causes later non-convexities in the linearized MISOCP formulation. These points have to be better explained on page 10 (where the authors just state that product of continuous variables in alpha-constraints introduces non-convexities). In Section 2.2. in the definition of the objective function, it should be mentioned that one minimizes the two sums, one of the weighted lengths and one of weigthed link distances. Moreover, more motivation for a choice of such objective function is needed. When introducing the graph G_X, it is not clear whether points P_S, P_T are given in advance, or whether we are searching for their coordinates (the latter is the case, bit this becomes clear much later in the paper after introducing the full MINLP model). For the set E_ST, shouldn't we also add in the definition that these line segments should not cross any other barrier from B? When introducing contstraints (N-C), please mention that P_N are variables.

- When introducing model variables, what is the domain of variables - for example, for alpha (P|QQ'), where does P, Q, and Q' come from? The same has to be clarified for all variables used in the model. I recommend to use notation f^{ST}_{PQ} instead of f(PQ|ST) - first, because it is a common way to state flow along a segment PQ for the commodity ST in that way, and second, to avoid confusion with the determinants notation (see minor remarks below).

- MINLP formulation: for all introduced constraints, please introduce quantifiers and variable domains for which these constraints are imposed. The authors state that they use single-commodity flow formulation to model client-facility allocation paths, however their model is a mix between single- and multi-commodity formulation (SCF and MCF, respectively). This has to be corrected, and in addition, there are indeed two ways to model it, as described below.

In the MCF approach, we need binary variables f^{ST}_PQ to be set to one for each ST pair, if line segment connecting P and Q is used. For the constraints (f-C), what is the definition of f(PQ) and what is the link between f^{ST}_{PQ} and f(PQ)? I believe constraints (f-C) should be replaced by stronger ones: f^{ST}_{PQ} <= eps(PQ) for all P, Q (please add the variable domain) and all S, T (please add variable domain). Finally, there is a quantifier missing in the flow-preservation constraints (flow-in equals flow-out): for all P is missing.

In the SCF approach, we would need flow variable indexed by source nodes S, modeling a tree routed at S and connecting all targets T such that x(ST)=1. These variables can then be denoted as f^S_PQ and their value is integer, counting the number of targets T allocated to S, that use segment PQ. In that case, the constraints (f_C) would read f^S_PQ <= |T| eps(PQ), for all P,Q,S and in the flow preservation constraints, we will have that the RHS for the flow-preservation constraints for P=S is equal to sum_{T in T} x(ST).

The authors state on page 9 "The fourth ones are the flow conservation constraints, where the units of commodity launched from the source must be the number of targets that are assigned to that source. The fifth group of inequalities ensures that the trip can reach, in endurance terms, the target T when it starts from the source S." From the first sentence, it seems to me the authors had in mind a SCF formulation, but this is not what the current model is providing. The second sentence mentions the fifth group of constraints which is actually missing in the model. Besides, what is meant with "endurance terms"? In the next MINLP model on page 10, there is a constraint that uses "endurance" but I do not think the endurance is defined earlier in the paper.

- Proposition 1 should be mentioned right after the problem definition at the end of Section 2. Besides, please give a formal definition of the k-median with geodesic distances and and a reference where it is shown that the latter problem is NP-hard.

- It is important to make publicly available instances used in this paper

- Computational results: are the authors using some kind of warm-start (sometimes called MIP-start) procedure to provide the solution found by the matheuristic to Gurobi? This should be better clarified. What is the major idea behind reporting Gap_build - why is it important to look at this metric? Is this a solution found by Gurobi without using matheuristic? Please clarify. On page 13 the authors state "Note that the maximum gap between the best incumbent solution obtained by the matheuristic in a time limit of 100
seconds and the best by the exact formulation after an hour is 5.96%." However, this gap is much larger in the tables provided, so this should be clarified.

- Finally, given that the problem is new and there are no "competitors", it would be interesting to see the difference in the performance between the SCF and MCF model mentioned above.

Minor concerns:

- on-the-self --> off-the-shelf

- Section 3.2., line 2: replace $\in E_X$ with "belongs to E_X".

- Please explain what in your notation det(P_1|PQ) means.

- When introducing gamma variables, mention that they are also obtained as McCormick linearization.

- Please simplify the notation and improve the formatting of the MINLP model on page 9 (there is no need to call the set of vertices V_KMPNH, you can use much shorter names for a better readability)

- Please use wlog or w.l.o.g. consistently

- Please use dots instead of comma for showing decimal numbers.
